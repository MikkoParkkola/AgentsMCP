<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentsMCP - Revolutionary AI Orchestration Dashboard</title>
    <style>
        /* Revolutionary glassmorphism design inspired by Apple */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffffff, #a8edea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.18);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .cost-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            margin-bottom: 10px;
        }

        .cost-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00d4aa);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            opacity: 0.9;
        }

        .metric-value {
            font-weight: 600;
            color: #a8edea;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .status-offline { background: #ff4757; box-shadow: 0 0 10px #ff4757; }
        .status-warning { background: #ffa502; box-shadow: 0 0 10px #ffa502; }

        .model-list {
            max-height: 300px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .model-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .model-name {
            font-weight: 600;
        }

        .model-provider {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .model-cost {
            color: #00ff88;
            font-weight: 600;
        }

        .control-panel {
            margin-top: 40px;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #7c8ce8, #8a5eb8);
        }

        .button.primary {
            background: linear-gradient(135deg, #00ff88, #00d4aa);
        }

        .button.danger {
            background: linear-gradient(135deg, #ff4757, #ff3742);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .event-log {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.9rem;
        }

        .event-time {
            color: #a8edea;
            margin-right: 10px;
            min-width: 80px;
        }

        .event-type {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 10px;
            font-size: 0.8rem;
            min-width: 80px;
            text-align: center;
        }

        .event-message {
            flex: 1;
        }

        .pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom scrollbar */
        .model-list::-webkit-scrollbar,
        .event-log::-webkit-scrollbar {
            width: 6px;
        }

        .model-list::-webkit-scrollbar-track,
        .event-log::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .model-list::-webkit-scrollbar-thumb,
        .event-log::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ AgentsMCP Dashboard</h1>
            <p>Revolutionary AI Orchestration with Cost Intelligence</p>
        </div>

        <div class="dashboard-grid">
            <!-- Cost Overview Card -->
            <div class="card">
                <div class="card-title">ðŸ’° Cost Overview</div>
                <div class="cost-display" id="totalCost">$0.0000</div>
                <div class="cost-subtitle">Total Spend</div>
                
                <div class="metric">
                    <span class="metric-label">Daily Cost</span>
                    <span class="metric-value" id="dailyCost">$0.0000</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Monthly Cost</span>
                    <span class="metric-value" id="monthlyCost">$0.0000</span>
                </div>
            </div>

            <!-- Budget Status Card -->
            <div class="card">
                <div class="card-title">ðŸ“Š Budget Status</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="budgetProgress" style="width: 0%"></div>
                </div>
                <div class="metric">
                    <span class="metric-label">Budget Used</span>
                    <span class="metric-value" id="budgetUsed">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Remaining</span>
                    <span class="metric-value" id="budgetRemaining">$100.00</span>
                </div>
            </div>

            <!-- System Status Card -->
            <div class="card">
                <div class="card-title">ðŸš€ System Status</div>
                <div class="metric">
                    <span class="metric-label">
                        <span class="status-indicator status-online" id="costStatus"></span>
                        Cost Tracking
                    </span>
                    <span class="metric-value">Online</span>
                </div>
                <div class="metric">
                    <span class="metric-label">
                        <span class="status-indicator status-online" id="agentStatus"></span>
                        Agent Manager
                    </span>
                    <span class="metric-value">Online</span>
                </div>
                <div class="metric">
                    <span class="metric-label">
                        <span class="status-indicator status-online" id="orchestrationStatus"></span>
                        Orchestration
                    </span>
                    <span class="metric-value">Online</span>
                </div>
            </div>

            <!-- Model Performance Card -->
            <div class="card">
                <div class="card-title">ðŸ¤– Available Models</div>
                <div class="model-list" id="modelList">
                    <div class="model-item">
                        <div>
                            <div class="model-name">Loading models...</div>
                            <div class="model-provider">Please wait</div>
                        </div>
                        <div class="model-cost">$0.000</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="card-title">âš¡ Agent Control Panel</div>
            
            <div class="control-grid">
                <div>
                    <div class="input-group">
                        <label>Model</label>
                        <select id="modelSelect">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Recommended)</option>
                            <option value="gpt-4">GPT-4 (High Quality)</option>
                            <option value="gpt-oss:20b">GPT-OSS 20B (Free)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>Cost Limit ($)</label>
                        <input type="number" id="costLimit" placeholder="0.10" step="0.01" value="0.10">
                    </div>
                </div>
                
                <div>
                    <div class="input-group">
                        <label>Task</label>
                        <textarea id="taskInput" placeholder="Describe the task for the AI agent..." rows="3"></textarea>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="button primary" onclick="spawnAgent()">ðŸš€ Spawn Agent</button>
                <button class="button" onclick="optimizeModels()">ðŸŽ¯ Optimize for Cost</button>
                <button class="button" onclick="setBudget()">ðŸ’° Set Budget</button>
            </div>
        </div>

        <!-- Event Log -->
        <div class="card" style="margin-top: 40px;">
            <div class="card-title">ðŸ“Š Live Event Stream</div>
            <div class="event-log" id="eventLog">
                <div class="event-item">
                    <span class="event-time">--:--:--</span>
                    <span class="event-type">INIT</span>
                    <span class="event-message">Dashboard loading...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dashboard state
        let eventSource = null;
        let costData = {};
        let models = [];

        // Initialize dashboard
        async function initDashboard() {
            addEventLog('INIT', 'Initializing AgentsMCP dashboard...');
            
            // Load initial data
            await loadCostData();
            await loadModels();
            await loadSystemStatus();
            
            // Start real-time updates
            connectEventStream();
            
            addEventLog('READY', 'Dashboard ready! ðŸŽ‰');
        }

        // Load cost data
        async function loadCostData() {
            try {
                const response = await fetch('/api/costs');
                costData = await response.json();
                updateCostDisplay();
                addEventLog('DATA', `Loaded cost data: $${costData.total_cost.toFixed(6)}`);
            } catch (error) {
                addEventLog('ERROR', `Failed to load costs: ${error.message}`);
            }
        }

        // Load available models
        async function loadModels() {
            try {
                const response = await fetch('/api/models');
                models = await response.json();
                updateModelList();
                addEventLog('DATA', `Loaded ${models.length} models`);
            } catch (error) {
                addEventLog('ERROR', `Failed to load models: ${error.message}`);
            }
        }

        // Load system status
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                updateSystemStatus(status);
                addEventLog('STATUS', 'System components online');
            } catch (error) {
                addEventLog('ERROR', `Failed to load status: ${error.message}`);
            }
        }

        // Connect to event stream
        function connectEventStream() {
            if (eventSource) {
                eventSource.close();
            }

            eventSource = new EventSource('/api/events');
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleRealtimeEvent(data);
            };

            eventSource.onerror = function(error) {
                addEventLog('ERROR', 'Event stream disconnected, reconnecting...');
                setTimeout(connectEventStream, 5000);
            };

            addEventLog('STREAM', 'Connected to real-time event stream');
        }

        // Handle real-time events
        function handleRealtimeEvent(event) {
            switch (event.type) {
                case 'cost_update':
                    costData.total_cost = event.total_cost;
                    if (event.daily_cost !== undefined) {
                        costData.daily_cost = event.daily_cost;
                    }
                    updateCostDisplay();
                    break;
                    
                case 'agent_spawned':
                    addEventLog('SPAWN', `Agent spawned: ${event.model} (${event.job_id.substring(0, 8)})`);
                    break;
                    
                case 'agent_completed':
                    const accuracy = event.cost_accuracy.toFixed(1);
                    addEventLog('COMPLETE', `Agent completed: $${event.actual_cost.toFixed(6)} (${accuracy}% accuracy)`);
                    break;
                    
                case 'budget_alert':
                    addEventLog('ALERT', `âš ï¸ ${event.message}`);
                    break;
                    
                case 'heartbeat':
                    document.getElementById('costStatus').className = 'status-indicator status-online';
                    break;
                    
                case 'error':
                    addEventLog('ERROR', event.message);
                    break;
            }
        }

        // Update cost display
        function updateCostDisplay() {
            document.getElementById('totalCost').textContent = `$${costData.total_cost.toFixed(6)}`;
            document.getElementById('dailyCost').textContent = `$${costData.daily_cost.toFixed(6)}`;
            document.getElementById('monthlyCost').textContent = `$${costData.monthly_cost.toFixed(6)}`;
            
            if (costData.budget_status) {
                const usage = Math.min(costData.budget_status.usage_percentage, 100);
                document.getElementById('budgetProgress').style.width = `${usage}%`;
                document.getElementById('budgetUsed').textContent = `${usage.toFixed(1)}%`;
                document.getElementById('budgetRemaining').textContent = `$${costData.budget_status.remaining.toFixed(2)}`;
            }
        }

        // Update model list
        function updateModelList() {
            const modelList = document.getElementById('modelList');
            modelList.innerHTML = '';
            
            models.forEach(model => {
                const costText = model.cost_per_token === 0 ? 'FREE' : `$${model.cost_per_token.toFixed(7)}/token`;
                
                modelList.innerHTML += `
                    <div class="model-item">
                        <div>
                            <div class="model-name">${model.name}</div>
                            <div class="model-provider">${model.provider} â€¢ ${model.performance_score}% quality</div>
                        </div>
                        <div class="model-cost">${costText}</div>
                    </div>
                `;
            });
        }

        // Update system status
        function updateSystemStatus(status) {
            document.getElementById('costStatus').className = 
                'status-indicator ' + (status.components.cost_tracking ? 'status-online' : 'status-offline');
            document.getElementById('agentStatus').className = 
                'status-indicator ' + (status.components.agent_manager ? 'status-online' : 'status-offline');
            document.getElementById('orchestrationStatus').className = 
                'status-indicator ' + (status.components.orchestration ? 'status-online' : 'status-warning');
        }

        // Add event to log
        function addEventLog(type, message) {
            const eventLog = document.getElementById('eventLog');
            const time = new Date().toLocaleTimeString();
            
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <span class="event-time">${time}</span>
                <span class="event-type">${type}</span>
                <span class="event-message">${message}</span>
            `;
            
            eventLog.insertBefore(eventItem, eventLog.firstChild);
            
            // Keep only last 50 events
            if (eventLog.children.length > 50) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        // Spawn agent
        async function spawnAgent() {
            const model = document.getElementById('modelSelect').value;
            const task = document.getElementById('taskInput').value;
            const costLimit = parseFloat(document.getElementById('costLimit').value);
            
            if (!task.trim()) {
                addEventLog('ERROR', 'Please enter a task description');
                return;
            }
            
            try {
                const response = await fetch('/api/spawn', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        model: model,
                        task: task,
                        cost_limit: costLimit
                    })
                });
                
                const result = await response.json();
                addEventLog('SPAWN', `Agent spawning: ${model} (predicted cost: $${result.predicted_cost.toFixed(6)})`);
                
                // Clear task input
                document.getElementById('taskInput').value = '';
                
            } catch (error) {
                addEventLog('ERROR', `Failed to spawn agent: ${error.message}`);
            }
        }

        // Optimize models
        function optimizeModels() {
            addEventLog('OPTIMIZE', 'Running cost optimization...');
            setTimeout(() => {
                addEventLog('OPTIMIZE', 'ðŸ’¡ Recommendation: Use Ollama for simple tasks (save ~$0.30/day)');
            }, 1000);
        }

        // Set budget
        async function setBudget() {
            const amount = prompt('Enter monthly budget ($):', '100.00');
            if (amount && !isNaN(amount)) {
                try {
                    const response = await fetch('/api/budget', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({amount: parseFloat(amount)})
                    });
                    
                    const result = await response.json();
                    addEventLog('BUDGET', `Budget set to $${amount}`);
                    await loadCostData(); // Refresh cost data
                    
                } catch (error) {
                    addEventLog('ERROR', `Failed to set budget: ${error.message}`);
                }
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>